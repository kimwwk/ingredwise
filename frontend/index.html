<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ingredient Checker</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #f5f5f5;
        color: #333;
        padding: 1rem;
      }

      header {
        text-align: center;
      }

      h1 {
        font-size: 2rem;
        margin-bottom: 0.5rem;
      }

      h2 {
        font-size: 1.2rem;
        color: #666;
      }

      .dropzone {
        display: flex;
        justify-content: center;
        align-items: center;
        border: 2px dashed #aaa;
        border-radius: 5px;
        background-color: #fff;
        padding: 2rem;
        text-align: center;
        cursor: pointer;
        margin: 2rem 0;
      }

      .submit-button {
        display: block;
        background-color: #333;
        color: #fff;
        border: none;
        border-radius: 5px;
        padding: 0.75rem 1.5rem;
        font-size: 1rem;
        text-align: center;
        cursor: pointer;
        margin: 0 auto;
      }

      .response-text-display {
        border: 1px solid #ccc; /* Outline color */
        border-radius: 5px; /* Rounded corners */
        padding: 20px; /* Space between the text and the border */
        margin: 20px; /* Space between the div and surrounding elements */
        font-family: Arial, sans-serif; /* Font family */
        font-size: 16px; /* Font size */
        line-height: 1.5; /* Line spacing */
        background-color: #f9f9f9; /* Background color */
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24); /* Box shadow */
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Ingredient Checker</h1>
      <h2>Upload, Identify & Review Ingredients</h2>
    </header>
    <main>
      <input
        type="file"
        id="file-input"
        accept="image/*"
        style="display: none"
      />
      <div
        class="dropzone"
        onclick="document.getElementById('file-input').click();"
      >
        <p>Drag and drop an image here, or click to select a file</p>
      </div>
      <button class="submit-button">Check Ingredients</button>
      <div id="response-text-display" class="response-text-display"></div>
    </main>
    <script>
      const dropzone = document.querySelector(".dropzone");
      const submitButton = document.querySelector(".submit-button");

      // Add event listener for file drop
      dropzone.addEventListener("drop", handleDrop);

      // Add event listener for file selection
      dropzone.addEventListener("change", handleDrop);

      // Add event listener for form submission
      submitButton.addEventListener("click", handleSubmit);

      function handleDrop(event) {
        event.preventDefault();
        const files = event.dataTransfer
          ? event.dataTransfer.files
          : event.target.files;
        uploadFile(files[0]);
      }

      function uploadFile(file) {
        const formData = new FormData();
        formData.append("file", file);
        const xhr = new XMLHttpRequest();
        xhr.open("POST", "/api/ingredient-check");
        xhr.onload = function () {
          if (xhr.status === 200) {
            alert("File uploaded successfully!");
            // Parse the JSON response
            const responseTextArray = JSON.parse(xhr.responseText);

            // Convert the array to a string with line breaks
            const responseText = responseTextArray.join("<br>");

            // Display the response text in the text display box
            const responseTextDisplay = document.getElementById(
              "response-text-display"
            );
            responseTextDisplay.innerHTML = responseText;
          } else {
            alert("Error uploading file. Please try again.");
          }
        };
        xhr.send(formData);
      }

      function handleSubmit(event) {
        event.preventDefault();
        const fileInput = document.createElement("input");
        fileInput.type = "file";
        fileInput.accept = "image/*";
        fileInput.onchange = handleDrop;
        fileInput.click();
      }

      function displayResponseText(responseText) {
        const responseContainer = document.querySelector(".response-container");
        responseContainer.innerHTML = "";

        const responseList = document.createElement("ul");
        responseText.forEach((text) => {
          const listItem = document.createElement("li");
          listItem.textContent = text;
          responseList.appendChild(listItem);
        });

        responseContainer.appendChild(responseList);
      }
    </script>
  </body>
</html>
